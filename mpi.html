<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Available MPI versions (and comparison) &mdash; HPC user-guides 2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/extra.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Performance" href="performance.html" />
    <link rel="prev" title="Software packages" href="software.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #E4067E" >

          
          
          <a href="index.html" class="icon icon-home">
            HPC user-guides
              <img src="_static/TalTech_Gradient-200px.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lumi.html">LUMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud.html">Quickstart: Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart: Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning.html">Courses and introductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Module environment (lmod)</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software packages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Available MPI versions (and comparison)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#layers-in-openmpi">Layers in OpenMPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#different-mpi-implementations-exist">Different MPI implementations exist:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#openmpi">OpenMPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpich">MPICH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mvapich">MVAPICH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recommendation">Recommendation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU-servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity.html">Containers (Singularity &amp; Docker)</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgement</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #E4067E" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">HPC user-guides</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Available MPI versions (and comparison)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mpi.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><span STYLE="font-size:18mm"> <span style="color:red">not changed to rocky yet</span></span></p>
<section id="available-mpi-versions-and-comparison">
<h1>Available MPI versions (and comparison)<a class="headerlink" href="#available-mpi-versions-and-comparison" title="Permalink to this heading"></a></h1>
<p>The cluster has OpenMPI installed.</p>
<p>The recommendation is to use <strong>OpenMPI</strong> <em><strong>(except you really know what you are doing)!!!</strong></em>
MPICH does <em><strong>not</strong></em> support InfiniBand. MVAPICH is <em><strong>not</strong></em> integrated with SLURM, you need to create the hostfile yourself from the slurm-nodelist.</p>
<p>On all nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">mpi</span><span class="o">/</span><span class="n">openmpi</span><span class="o">-</span><span class="n">x86_64</span>
</pre></div>
</div>
<p>OpenMPI will choose the fastest interface, it will try RDMA over Ethernet (RoCE) which causes <em>“[qelr_create_qp:683]create qp: failed on ibv_cmd_create_qp”</em> messages, these can be ignored, it will fail over to IB (higher bandwidth anyway) or TCP.</p>
<p>For MPI jobs prefer the <strong>green-ib</strong> partition (<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">-p</span> <span class="pre">green-ib</span></code>) or stay within a single node (<code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">-N</span> <span class="pre">1</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">--</span><span class="n">mca</span> <span class="n">btl_openib_warn_no_device_params_found</span> <span class="mi">0</span> <span class="o">./</span><span class="n">hello</span><span class="o">-</span><span class="n">mpi</span>
</pre></div>
</div>
<br>
<hr style="margin-right: 0px; margin-bottom: 4px; margin-left: 0px; margin-top: -24px; border:2px solid  #d9d9d9 "></hr>
<hr style="margin: 4px 0px; border:1px solid  #d9d9d9 "></hr><section id="layers-in-openmpi">
<h2>Layers in OpenMPI<a class="headerlink" href="#layers-in-openmpi" title="Permalink to this heading"></a></h2>
<hr class="docutils" />
<ul class="simple">
<li><p>PML = Point-to-point Management Layer:</p>
<ul>
<li><p>UCX</p></li>
</ul>
</li>
<li><p>MTL = Message Transfer Layer:</p>
<ul>
<li><p>PSM,</p></li>
<li><p>PSM2,</p></li>
<li><p>OFI</p></li>
</ul>
</li>
<li><p>BTL = Byte Transfer Layer:</p>
<ul>
<li><p>TCP,</p></li>
<li><p>openib</p></li>
<li><p>self</p></li>
<li><p>sm (OpenMPI 1), vader (OpenMPI 4)</p></li>
</ul>
</li>
</ul>
<br><p>The layers can be confusing, so was openib originally developed for InfiniBand, but is now used for RoCE and is deprecated for IB. However, on some IB cards and configurations it is the only working option. Also, the MVAPICH implementation still uses the openib (verbs) instead of UCX.</p>
<p>Layers can be selected with the <code class="docutils literal notranslate"><span class="pre">--mca</span></code> option of <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>:</p>
<p>To select TCP transport:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">--</span><span class="n">mca</span> <span class="n">btl</span> <span class="n">tcp</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">vader</span>
</pre></div>
</div>
<p>To select RDMA transport (verbs):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">--</span><span class="n">mca</span> <span class="n">btl</span> <span class="n">openib</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">vader</span>
</pre></div>
</div>
<p>To select UCX transport:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">--</span><span class="n">mca</span> <span class="n">pml</span> <span class="n">ucx</span> 
</pre></div>
</div>
<p>Or using environment variables, e.g. <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OMPI_MCA_btl=tcp,self,vader</span></code>.</p>
<p><em><strong>NB!</strong></em> <em>UCX is not supported on QLogic FastLinQ QL41000 Ethernet controllers.</em></p>
<p><em><strong>NB!</strong></em> <em>UCX 1.8 on amps from Ubuntu is broken, use SPACK version</em></p>
<div class="simple1">
For further explanations and details see:<ul class="simple">
<li><p><a class="reference external" href="https://www.open-mpi.org/faq/?category=tuning">https://www.open-mpi.org/faq/?category=tuning</a></p></li>
<li><p><a class="reference external" href="https://www.open-mpi.org/faq/?category=openfabrics">https://www.open-mpi.org/faq/?category=openfabrics</a></p></li>
</ul>
</div>
<br>
<br>
<hr style="margin-right: 0px; margin-bottom: 4px; margin-left: 0px; margin-top: -24px; border:2px solid  #d9d9d9 "></hr>
<hr style="margin: 4px 0px; border:1px solid  #d9d9d9 "></hr></section>
<section id="different-mpi-implementations-exist">
<h2>Different MPI implementations exist:<a class="headerlink" href="#different-mpi-implementations-exist" title="Permalink to this heading"></a></h2>
<hr class="docutils" />
<ul class="simple">
<li><p>OpenMPI</p></li>
<li><p>MPICH</p></li>
<li><p>MVAPICH</p></li>
<li><p>IBM Platform MPI (MPICH descendant)</p></li>
<li><p>IBM Spectrum MPI (OpenMPI descendant)</p></li>
<li><p>(at least one for each network and CPU manufacturer)</p></li>
</ul>
<br><section id="openmpi">
<h3>OpenMPI<a class="headerlink" href="#openmpi" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>available in any Linux or BSD distribution</p></li>
<li><p>combining technologies and resources from several other projects (incl. LAM/MPI)</p></li>
<li><p>can use TCP/IP, shared memory, Myrinet, Infiniband and other low latency interconnects</p></li>
<li><p>chooses fastest interconnect automatically (can be manually choosen, too)</p></li>
<li><p>well integrated into many schedulers (e.g. SLURM)</p></li>
<li><p>highly optimized</p></li>
<li><p>FOSS (BSD license)</p></li>
</ul>
<br></section>
<section id="mpich">
<h3>MPICH<a class="headerlink" href="#mpich" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>highly optimized</p></li>
<li><p>supports TCP/IP and some low latency interconnects</p></li>
<li><p>(older versions) DO NOT support InfiniBand (however, it supports MELLANOX IB)</p></li>
<li><p>available in many Linux distributions</p></li>
<li><p>? not intgrated into schedulers &lt;!— is this correct? Maybe, “?” mark is better?—&gt;</p></li>
<li><p>used to be a PITA to get working smoothly</p></li>
<li><p>FOSS</p></li>
</ul>
<br></section>
<section id="mvapich">
<h3>MVAPICH<a class="headerlink" href="#mvapich" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>highly optimized (maybe slightly faster than OpenMPI)</p></li>
<li><p>fork of MPICH to support IB</p></li>
<li><p>comes in many flavors to support TCP/IP, InfiniBand and many low latency interconnects: OpenSHMEM, PGAS</p></li>
<li><p>need to install several flavors and users need to choose the right one for the interconnect they want to use</p></li>
<li><p>generally not available in Linux distributions</p></li>
<li><p>not integrated with schedulers (integrated with SLURM only after version 18)</p></li>
<li><p>FOSS (BSD license)</p></li>
</ul>
<br></section>
<section id="recommendation">
<h3>Recommendation<a class="headerlink" href="#recommendation" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>default: use OpenMPI on both clusters</p></li>
<li><p>if unsatisfied with performance and running on single node or over TCP, try MPICH</p></li>
<li><p>if unsatisfied with performance and running on IB try MVAPICH</p></li>
</ul>
<br>
<div class="simple1">
For a comparison, see for example:<ul class="simple">
<li><p><a class="reference external" href="https://www.chpc.utah.edu/documentation/software/mpilibraries.php">https://www.chpc.utah.edu/documentation/software/mpilibraries.php</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/2427399/mpich-vs-openmpi">https://stackoverflow.com/questions/2427399/mpich-vs-openmpi</a></p></li>
</ul>
</div>
<br>
<br></section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="software.html" class="btn btn-neutral float-left" title="Software packages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="performance.html" class="btn btn-neutral float-right" title="Performance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>